"use strict";(self.webpackChunkspm_kubernetes=self.webpackChunkspm_kubernetes||[]).push([[178],{376:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return i},default:function(){return u}});var a=t(45),l=(t(6540),t(5680)),o=t(4330);const r=["components"],i={},p=(m="InlineNotification",function(e){return console.warn("Component "+m+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.yg)("div",e)});var m;const s={_frontmatter:i},g=o.A;function u(e){let{components:n}=e,t=(0,a.A)(e,r);return(0,l.yg)(g,Object.assign({},s,t,{components:n,mdxType:"MDXLayout"}),(0,l.yg)("h2",null,"Introduction"),(0,l.yg)("p",null,"This topic describes how to configure XML server tracing when deployed to Kubernetes."),(0,l.yg)("p",null,"For more information about XML server tracing, see ",(0,l.yg)("strong",{parentName:"p"},"Debug configuration")," in the ",(0,l.yg)("em",{parentName:"p"},"Social Program Management XML Infrastructure Guide"),"."),(0,l.yg)(p,{mdxType:"InlineNotification"},(0,l.yg)("p",null,"The Social Program Management PDF documentation is available to download from ",(0,l.yg)("a",{parentName:"p",href:"https://curam-spm-devops.github.io/wh-support-docs/spm/pdf-documentation/"},"Merative Support Docs"),".")),(0,l.yg)("p",null,"However, to use it in a Kubernetes environment you will need to perform the steps described in this section."),(0,l.yg)("p",null,"In summary, you will need to:"),(0,l.yg)("ol",null,(0,l.yg)("li",{parentName:"ol"},"Create a new ConfigMap to override the trace setting in the default ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserverconfig.xml.template")," file"),(0,l.yg)("li",{parentName:"ol"},"Optionally you can (for the ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserver")," deployment only) create a ConfigMap to override its default log4j properties file.")),(0,l.yg)("p",null,"The Kubernetes commands presented in this topic are generic and assume a helm release name of ",(0,l.yg)("inlineCode",{parentName:"p"},"releasename"),".\nTo enter the commands in this topic as-is you need to enter the following commands first, substituting ",(0,l.yg)("inlineCode",{parentName:"p"},"<name_space>")," for the OpenShift project name or AKS namespace for your deployment:"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"For Openshift:",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Create an alias for the ",(0,l.yg)("inlineCode",{parentName:"li"},"oc")," command:",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Bash: ",(0,l.yg)("inlineCode",{parentName:"li"},"alias k='oc'")),(0,l.yg)("li",{parentName:"ul"},"Windows PowerShell: ",(0,l.yg)("inlineCode",{parentName:"li"},"Set-Alias -Name k -Value oc")))),(0,l.yg)("li",{parentName:"ul"},"Set the default namespace:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k project <name_space>")))),(0,l.yg)("li",{parentName:"ul"},"For AKS:",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Create an alias for the ",(0,l.yg)("inlineCode",{parentName:"li"},"kubectl")," command:",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Bash: ",(0,l.yg)("inlineCode",{parentName:"li"},"alias k='kubectl'")),(0,l.yg)("li",{parentName:"ul"},"Windows PowerShell: ",(0,l.yg)("inlineCode",{parentName:"li"},"Set-Alias -Name k -Value kubectl")))),(0,l.yg)("li",{parentName:"ul"},"Set the default namespace:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k config set-context --current --namespace=<name_space>"))))),(0,l.yg)("h3",null,"Specifying the XML server trace setting"),(0,l.yg)("p",null,"To enable XML server tracing you need to modify the out-of-the-box setting:"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Copy the ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserver")," pod’s ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserverconfig.xml.template")," file to your local file system using the Kubernetes copy command.  For example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k cp <xmlserver-pod-name>:xmlserverconfig.xml.template xmlserverconfig.xml.template -c xmlserver")),(0,l.yg)("li",{parentName:"ul"},"Edit the local ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserverconfig.xml.template")," file to change the ",(0,l.yg)("inlineCode",{parentName:"li"},"TRACE_TRAFFIC")," value as follows:\n",(0,l.yg)("inlineCode",{parentName:"li"},"<TRACE_TRAFFIC>true</TRACE_TRAFFIC>")),(0,l.yg)("li",{parentName:"ul"},"Delete the existing ",(0,l.yg)("inlineCode",{parentName:"li"},"releasename-xmlserverconfig-template-cm")," ConfigMap. For example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k delete configmap releasename-xmlserverconfig-template-cm")),(0,l.yg)("li",{parentName:"ul"},"Create a new ",(0,l.yg)("inlineCode",{parentName:"li"},"releasename-xmlserverconfig-template-cm")," ConfigMap using your edited copy of ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserverconfig.xml.template"),"; for example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k create releasename-xmlserverconfig-template-cm --from-file=xmlserverconfig.xml.template"),"\nThe existing ",(0,l.yg)("inlineCode",{parentName:"li"},"releasename-xmlserverconfig-template-cm")," ConfigMap in the ",(0,l.yg)("inlineCode",{parentName:"li"},"releasename-xmlserver")," deployment will be replaced with your newly edited file."),(0,l.yg)("li",{parentName:"ul"},"You must restart the xmlserver pod(s) for the new setting to be used. You can restart the pod(s) using the Kubernetes ",(0,l.yg)("inlineCode",{parentName:"li"},"delete pod")," command.  For example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k delete pod <xmlserver-pod-name>"),"\nThis will terminate the running pod and start a new pod that reflects the new ConfigMap.")),(0,l.yg)("h3",null,"Modifying the log4j properties"),(0,l.yg)("p",null,"The out-of-the-box ",(0,l.yg)("inlineCode",{parentName:"p"},"log4j2.properties")," file will write the XML server trace output to stdout, which is routed to the pod’s ",(0,l.yg)("inlineCode",{parentName:"p"},"tmp/xmlserver.log")," file.\nOptionally, you can provide your own custom log4j properties file.\nFor instance, it can be useful to modify the output layout to indicate the time-of-day and the worker thread processing the XML server job.\nFor example this log4j pattern:"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},"appender.A1.layout.pattern=[%p] %d{ABSOLUTE_MICROS} [%t] [%c{1}] %m%n\n")),(0,l.yg)("p",null,"will produce output in this format:"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},"[xmlserver] [INFO] 14:01:46,165000 [ThreadPoolWorker-1] [XMLConnectionHandler] - Awaiting job configuration.\n")),(0,l.yg)("p",null,"as compared to the out-of-the-box format:"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},"[xmlserver] [INFO] [XMLConnectionHandler] Awaiting job configuration.\n")),(0,l.yg)("p",null,"For more information on specifying log4j patterns see the ",(0,l.yg)("a",{parentName:"p",href:"https://logging.apache.org/log4j/2.x/manual/layouts.html"},"Layouts section")," of the ",(0,l.yg)("a",{parentName:"p",href:"https://logging.apache.org/log4j/2.x/manual/index.html"},"log4j documentation"),"."),(0,l.yg)("p",null,"To modify the ",(0,l.yg)("inlineCode",{parentName:"p"},"log4j2.properties")," file:"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Copy the ",(0,l.yg)("inlineCode",{parentName:"li"},"xmlserver")," pod’s ",(0,l.yg)("inlineCode",{parentName:"li"},"log4j2.properties")," file to your local file system using the Kubernetes copy command.  For example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k cp <xmlserver-pod-name>:/opt/ibm/Curam/xmlserver/log4j2.properties log4j2.properties -c xmlserver")),(0,l.yg)("li",{parentName:"ul"},"Edit the local file to specify the desired log4j configuration settings."),(0,l.yg)("li",{parentName:"ul"},"Create a ConfigMap using your edited copy of ",(0,l.yg)("inlineCode",{parentName:"li"},"log4j2.properties"),"; for example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k create configmap xmlserver-log4j-props-cm --from-file=log4j2.properties")),(0,l.yg)("li",{parentName:"ul"},"Edit the xmlserver deployment to specify the new ConfigMap:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k edit deployment releasename-xmlserver"),(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"In the subsequent edit session add the entries for the new ConfigMap, matching the name used when creating it; for example:")))),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre"},"...\n        volumeMounts:\n        ...\n        - mountPath: /opt/ibm/Curam/xmlserver/log4j2.properties\n          name: xmlserver-log4j-props-cm\n          subPath: log4j2.properties\n...\n      volumes:\n      ...\n      - configMap:\n          defaultMode: 420\n          name: xmlserver-log4j-props-cm\n        name: xmlserver-log4j-props-cm\n")),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"You must restart the xmlserver pod(s) for it to reflect the new trace setting. You can restart the pod by using the Kubernetes ",(0,l.yg)("inlineCode",{parentName:"li"},"delete pod")," command.  For example:\n",(0,l.yg)("inlineCode",{parentName:"li"},"k delete pod <xmlserver-pod-name>"),"\nThis will terminate the running pod and start a new pod that reflects the new ConfigMap that contains the log4j properties.")))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-troubleshooting-xmlserver-trace-mdx-c5ff83b7fcd360fdc964.js.map